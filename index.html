
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>塔臺地面管制術語小測驗</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .option-btn {
            transition: all 0.2s ease-in-out;
        }
        .correct {
            background-color: #22c55e !important;
            color: white !important;
            border-color: #16a34a !important;
            transform: scale(1.05);
        }
        .incorrect {
            background-color: #ef4444 !important;
            color: white !important;
            border-color: #dc2626 !important;
        }
        .disabled {
            pointer-events: none;
            opacity: 0.7;
        }
    </style>
</head>
<body class="bg-white flex justify-center pt-12 px-4 min-h-screen">
<div id="quiz-container" class="w-full max-w-2xl mx-auto p-6 md:p-8">
    <div id="start-screen" class="text-center">
        <h1 class="text-xl sm:text-3xl font-bold text-slate-800 mb-4">塔臺地面管制術語小測驗</h1>
        <p class="text-slate-600 mb-8">快來小試身手10個問題!</p>
        <button id="start-btn" class="w-full max-w-xs bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105">開始測驗</button>
    </div>
    <div id="quiz-screen" class="hidden">
        <div class="flex justify-between items-center mb-6">
            <div id="progress" class="text-lg font-semibold text-slate-500">問題 1 / 10</div>
            <div id="score" class="text-lg font-bold text-blue-600">分數: 0</div>
        </div>
        <div class="mb-6">
            <p class="text-slate-500 text-sm font-medium mb-2">請根據以下中文意思，選擇正確的專業術語：</p>
            <div id="question" class="text-xl sm:text-2xl font-bold text-slate-800 bg-slate-50 p-4 rounded-lg min-h-[100px] flex flex-col items-start"></div>
        </div>
        <div id="options-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6"></div>
        <div id="feedback-container" class="text-center hidden">
            <p id="feedback-text" class="text-xl font-bold mb-4"></p>
            <button id="next-btn" class="w-full sm:w-auto bg-slate-700 hover:bg-slate-800 text-white font-bold py-3 px-8 rounded-lg text-lg transition-transform transform hover:scale-105">下一題</button>
        </div>
    </div>
    <div id="result-screen" class="hidden text-center">
        <h2 class="text-3xl md:text-4xl font-bold text-slate-800 mb-4">測驗結束！</h2>
        <p class="text-2xl text-slate-600 mb-2">你的最終成績是：</p>
        <p id="final-score" class="text-6xl font-bold text-blue-600 mb-8">0 / 10</p>
        <button id="restart-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105">再玩一次</button>
    </div>
</div>
<script>
    const startBtn = document.getElementById('start-btn');
    const nextBtn = document.getElementById('next-btn');
    const restartBtn = document.getElementById('restart-btn');
    const startScreen = document.getElementById('start-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultScreen = document.getElementById('result-screen');
    const questionText = document.getElementById('question');
    const optionsContainer = document.getElementById('options-container');
    const feedbackContainer = document.getElementById('feedback-container');
    const feedbackText = document.getElementById('feedback-text');
    const scoreText = document.getElementById('score');
    const progressText = document.getElementById('progress');
    const finalScoreText = document.getElementById('final-score');

    let allQuestions = [];
    let quizQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    const TOTAL_QUESTIONS = 10;
    const IMAGE_PATH = './answers/';

    async function loadQuestions() {
        try {
            const response = await fetch('questions.json');
            if (!response.ok) throw new Error('無法載入題庫');
            allQuestions = await response.json();
        } catch (error) {
            console.error(error);
            questionText.textContent = error.message;
        }
    }

    function startQuiz() {
        score = 0;
        currentQuestionIndex = 0;
        quizQuestions = shuffleArray([...allQuestions]).slice(0, TOTAL_QUESTIONS);
        startScreen.classList.add('hidden');
        resultScreen.classList.add('hidden');
        quizScreen.classList.remove('hidden');
        displayQuestion();
    }

    function displayQuestion() {
        feedbackContainer.classList.add('hidden');
        optionsContainer.classList.remove('disabled');
        optionsContainer.innerHTML = '';
        questionText.innerHTML = `<span>${quizQuestions[currentQuestionIndex].definition}</span>`;
        progressText.textContent = `問題 ${currentQuestionIndex + 1} / ${TOTAL_QUESTIONS}`;
        scoreText.textContent = `分數: ${score}`;

        const correctAnswer = quizQuestions[currentQuestionIndex].term;
        const options = generateOptions(correctAnswer);
        options.forEach(option => {
            const button = document.createElement('button');
            button.textContent = option;
            button.className = 'option-btn w-full p-4 border-2 border-slate-300 rounded-lg text-left text-lg font-semibold text-slate-700 hover:bg-slate-100 hover:border-blue-500';
            button.addEventListener('click', () => selectAnswer(option, correctAnswer, button));
            optionsContainer.appendChild(button);
        });
    }

    function generateOptions(correctAnswer) {
        let options = [correctAnswer];
        let wrongAnswers = allQuestions.map(q => q.term).filter(term => term !== correctAnswer);
        return shuffleArray([...options, ...shuffleArray(wrongAnswers).slice(0, 3)]);
    }

    function selectAnswer(selectedAnswer, correctAnswer, selectedButton) {
        optionsContainer.classList.add('disabled');
        const isCorrect = selectedAnswer === correctAnswer;

        if (isCorrect) {
            score++;
            feedbackText.textContent = '答對了！';
            feedbackText.className = 'text-xl font-bold mb-4 text-green-600';
            selectedButton.classList.add('correct');
            displayAnswerImage(correctAnswer);
        } else {
            feedbackText.textContent = `答錯了！正確答案是 ${correctAnswer}`;
            feedbackText.className = 'text-xl font-bold mb-4 text-red-600';
            selectedButton.classList.add('incorrect');
            Array.from(optionsContainer.children).forEach(btn => {
                if (btn.textContent === correctAnswer) btn.classList.add('correct');
            });
        }

        scoreText.textContent = `分數: ${score}`;
        feedbackContainer.classList.remove('hidden');
        if (currentQuestionIndex === TOTAL_QUESTIONS - 1) nextBtn.textContent = '查看結果';
    }

    function displayAnswerImage(term) {
        const imageName = term.replace(/\s+/g, '_') + '.jpg';
        const imageUrl = IMAGE_PATH + imageName;
        const img = document.createElement('img');
        img.src = imageUrl;
        img.alt = `正確答案 ${term} 的圖片`;
        img.className = 'mt-4 w-full max-h-60 object-contain rounded-lg border border-slate-300';
        img.onload = () => questionText.appendChild(img);
        img.onerror = () => console.error(`無法載入圖片: ${imageUrl}`);
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < TOTAL_QUESTIONS) {
            displayQuestion();
        } else {
            showResults();
        }
    }

    function showResults() {
        quizScreen.classList.add('hidden');
        resultScreen.classList.remove('hidden');
        finalScoreText.textContent = `${score} / ${TOTAL_QUESTIONS}`;
        nextBtn.textContent = '下一題';
    }

    function shuffleArray(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex !== 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }
        return array;
    }

    startBtn.addEventListener('click', startQuiz);
    nextBtn.addEventListener('click', nextQuestion);
    restartBtn.addEventListener('click', startQuiz);
    loadQuestions();
</script>
</body>
</html>
